<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seat Reservation - Concert Ticketing System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <nav>
            <a href="index.html">Home</a>
            <a href="concerts.html">Concerts</a>
            <a href="signup.html">Sign Up</a>
            <a href="login.html">Log In</a>
            <a href="seat-reservation.html">Seat Reservation</a>
            <a href="account.html">My Account</a>
        </nav>
    </header>
    <main>
        <h1>Reserve Your Seat</h1>
        <div id="seat-map" class="container">
            <!-- Seat map dynamically generated -->
        </div>
        <button id="confirm-reservation">Confirm Reservation</button>
    </main>
    <script>
        const userId = localStorage.getItem("userId");
        if (!userId) {
            alert("You need to log in first!");
            window.location.href = "login.html";
        }

        const concertId = "example-concert-id"; // Replace with actual concert ID

        async function loadSeats() {
            const response = await fetch(`https://your-api-url/concerts/${concertId}/seats`);
            const seats = await response.json();
            const seatMap = document.getElementById("seat-map");

            seats.forEach((seat, index) => {
                const seatElement = document.createElement("div");
                seatElement.classList.add("seat");
                seatElement.textContent = seat.number;
                seatElement.style.backgroundColor = seat.isBooked ? "red" : "green";
                seatElement.onclick = () => selectSeat(seat, seatElement);
                seatMap.appendChild(seatElement);
            });
        }

        let selectedSeat = null;
        function selectSeat(seat, element) {
            if (seat.isBooked) {
                alert("Seat already reserved.");
                return;
            }
            document.querySelectorAll(".seat").forEach(s => s.style.border = "none");
            element.style.border = "2px solid blue";
            selectedSeat = seat;
        }

        document.getElementById("confirm-reservation").addEventListener("click", async () => {
            if (!selectedSeat) {
                alert("Please select a seat.");
                return;
            }
            try {
                const response = await fetch(`https://your-api-url/reservations`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ userId, concertId, seatNumber: selectedSeat.number })
                });
                if (response.ok) {
                    alert("Seat reserved successfully!");
                    loadSeats(); // Refresh seat map
                } else {
                    alert("Error reserving seat.");
                }
            } catch (error) {
                console.error("Error:", error);
            }
        });

        loadSeats();
    </script>
    <style>
        .seat {
            display: inline-block;
            width: 30px;
            height: 30px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</body>
</html>
